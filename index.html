<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MidwifeApp</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { text-align: center; color: #333; }
        .lang-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .item.overdue { border-color: #ff0000; background-color: #ffecec; }
        .icon { font-size: 24px; margin-right: 15px; color: #666; }
        .content { flex: 1; }
        .title { font-size: 18px; font-weight: bold; margin: 0; }
        .description { font-size: 14px; color: #666; margin: 5px 0; }
        .last-time { font-size: 12px; color: #888; }
        button {
            background-color: #007bff; color: white; border: none; border-radius: 20px;
            padding: 8px 15px; font-size: 14px; cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        #error-message { color: red; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="lang-switch">
        <span onclick="setLanguage('ru')">ğŸ‡·ğŸ‡º</span>
        <span onclick="setLanguage('en')">ğŸ‡¬ğŸ‡§</span>
        <span onclick="setLanguage('de')">ğŸ‡©ğŸ‡ª</span>
    </div>

    <h1 id="app-title"></h1>
    <div id="error-message"></div>

    <div class="item" id="feeding">
        <span class="icon">ğŸ¼</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <div class="item" id="diaper">
        <span class="icon">ğŸ©²</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <div class="item" id="sleep">
        <span class="icon">ğŸŒ™</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <div class="item" id="temperature">
        <span class="icon">ğŸŒ¡ï¸</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <div class="item" id="burping">
        <span class="icon">ğŸ˜Š</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <div class="item" id="contact">
        <span class="icon">âœ‹</span>
        <div class="content">
            <p class="title"></p>
            <p class="description"></p>
            <p class="last-time"></p>
        </div>
        <button></button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

        const errorMessage = document.getElementById('error-message');

        const translations = {
            ru: {
                title: "ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ğ¶Ğ´Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ â€” Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°",
                items: {
                    feeding: { title: "ĞšĞ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ", desc: "ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2-3 Ñ‡Ğ°ÑĞ° Ğ´Ğ½Ñ‘Ğ¼ Ğ¸ Ğ½Ğ¾Ñ‡ÑŒÑ" },
                    diaper: { title: "ĞŸĞ¾Ğ´Ğ³ÑƒĞ·Ğ½Ğ¸Ğº", desc: "ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2-4 Ñ‡Ğ°ÑĞ°" },
                    sleep: { title: "Ğ¡Ğ¾Ğ½", desc: "Ğ² ÑÑ€ĞµĞ´Ğ½ĞµĞ¼ 14-17 Ñ‡Ğ°ÑĞ¾Ğ² Ğ² ÑÑƒÑ‚ĞºĞ¸" },
                    temperature: { title: "Ğ¢ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°", desc: "ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2-3 Ñ‡Ğ°ÑĞ°" },
                    burping: { title: "ĞÑ‚Ñ€Ñ‹Ğ¶ĞºĞ°", desc: "Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ñ" },
                    contact: { title: "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚", desc: "ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ĞºÑ€Ğ°Ñ‚Ğ½Ğ¾" }
                },
                button: "Ğ¡Ğ´ĞµĞ»Ğ°Ğ½Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ",
                never: "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ·: Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ°",
                ago: m => `ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ·: ${m} Ğ¼Ğ¸Ğ½. Ğ½Ğ°Ğ·Ğ°Ğ´`
            },
            en: {
                title: "Newborn Needs â€” Priority and Frequency",
                items: {
                    feeding: { title: "Feeding", desc: "every 2-3 hours, day and night" },
                    diaper: { title: "Diaper", desc: "every 2-4 hours" },
                    sleep: { title: "Sleep", desc: "average 14-17 hours per day" },
                    temperature: { title: "Temperature", desc: "every 2-3 hours" },
                    burping: { title: "Burping", desc: "after each feeding" },
                    contact: { title: "Contact", desc: "daily, multiple times" }
                },
                button: "Done now",
                never: "Last time: never",
                ago: m => `Last time: ${m} min ago`
            },
            de: {
                title: "Neugeborenen-BedÃ¼rfnisse â€” PrioritÃ¤t und HÃ¤ufigkeit",
                items: {
                    feeding: { title: "FÃ¼ttern", desc: "alle 2â€“3 Stunden, Tag und Nacht" },
                    diaper: { title: "Windel", desc: "alle 2â€“4 Stunden" },
                    sleep: { title: "Schlaf", desc: "durchschnittlich 14â€“17 Stunden pro Tag" },
                    temperature: { title: "Temperatur", desc: "alle 2â€“3 Stunden" },
                    burping: { title: "BÃ¤uerchen", desc: "nach jeder FÃ¼tterung" },
                    contact: { title: "Kontakt", desc: "tÃ¤glich, mehrmals" }
                },
                button: "Jetzt erledigt",
                never: "Zuletzt: nie",
                ago: m => `Zuletzt: vor ${m} Min.`
            }
        };

        let currentLang = 'ru';

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('app-title').textContent = translations[lang].title;
            Object.keys(translations[lang].items).forEach(id => {
                const el = document.getElementById(id);
                el.querySelector('.title').textContent = translations[lang].items[id].title;
                el.querySelector('.description').textContent = translations[lang].items[id].desc;
                if (!el.querySelector('.last-time').dataset.timestamp) {
                    el.querySelector('.last-time').textContent = translations[lang].never;
                }
                el.querySelector('button').textContent = translations[lang].button;
            });
        }

        const app = initializeApp({
            apiKey: "AIzaSyBUUrP-CevoeDOsUZorjC6XDzZ-vd3Uauw",
            authDomain: "ds-nurce-bdc37.firebaseapp.com",
            databaseURL: "https://ds-nurce-bdc37-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ds-nurce-bdc37",
            storageBucket: "ds-nurce-bdc37.appspot.com",
            messagingSenderId: "725307523922",
            appId: "1:725307523922:web:9bb5c6ae685e479719b08b"
        });

        const db = getDatabase(app);

        const items = [
            { id: 'feeding', max: 180 },
            { id: 'diaper', max: 240 },
            { id: 'sleep', max: 1440 },
            { id: 'temperature', max: 180 },
            { id: 'burping', max: 180 },
            { id: 'contact', max: 1440 }
        ];

        function updateTime(id, maxMinutes, timestamp) {
            const item = document.getElementById(id);
            const lastTimeElem = item.querySelector('.last-time');
            if (timestamp) {
                const diff = Date.now() - timestamp;
                const minutesAgo = Math.floor(diff / 60000);
                lastTimeElem.dataset.timestamp = timestamp;
                lastTimeElem.textContent = translations[currentLang].ago(minutesAgo);
                item.classList.toggle('overdue', minutesAgo > maxMinutes);
            } else {
                lastTimeElem.textContent = translations[currentLang].never;
                item.classList.add('overdue');
            }
        }

        window.markDone = function (id, maxMinutes) {
            const now = Date.now();
            set(ref(db, 'actions/' + id), { timestamp: now })
                .catch(err => {
                    console.error(err);
                    errorMessage.textContent = `Error: ${err.message}`;
                });
        };

        items.forEach(item => {
            const r = ref(db, 'actions/' + item.id);
            onValue(r, snap => {
                const data = snap.val();
                updateTime(item.id, item.max, data ? data.timestamp : null);
            }, err => {
                console.error(err);
                errorMessage.textContent = `Error: ${err.message}`;
            });
        });

        setInterval(() => {
            items.forEach(item => {
                const el = document.getElementById(item.id);
                const ts = el.querySelector('.last-time').dataset.timestamp;
                if (ts) {
                    const minutesAgo = Math.floor((Date.now() - ts) / 60000);
                    el.querySelector('.last-time').textContent = translations[currentLang].ago(minutesAgo);
                    if (minutesAgo > item.max) el.classList.add('overdue');
                }
            });
        }, 60000);

        setLanguage('ru');
    </script>
</body>
</html>
