<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω–æ–≥–æ</title>
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoi0J/QvtC/0YLQtdC00L3QuNC1INC+0L3QvtCy0L7Rg9C00LvRjyDQvdC+0LLRgNC+0YHRgtCw0L0iLCJzaG9ydF9uYW1lIjoi0J/QvtC/0YLQtdC00L3QuNC1IiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vZmF2aWNvbi5pY28iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvaWNvIn1dLCJ0aGVtZV9jb2xvciI6IiNmZmZmZmYiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwic3RhcnRfdXJsIjoiLiJ9">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .item.overdue {
            border-color: #ff0000;
            background-color: #ffecec;
        }
        .icon {
            font-size: 24px;
            margin-right: 15px;
            color: #666;
        }
        .content {
            flex: 1;
        }
        .title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .description {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        .last-time {
            font-size: 12px;
            color: #888;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ—Ä–æ–∂–¥—ë–Ω–Ω–æ–≥–æ ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ —á–∞—Å—Ç–æ—Ç–∞</h1>
    <div id="error-message"></div>

    <div class="item" id="feeding">
        <span class="icon">üçº</span>
        <div class="content">
            <p class="title">–ö–æ—Ä–º–ª–µ–Ω–∏–µ</p>
            <p class="description">–∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞ –¥–Ω—ë–º –∏ –Ω–æ—á—å—é</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('feeding', 180)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div class="item" id="diaper">
        <span class="icon">ü©≤</span>
        <div class="content">
            <p class="title">–ü–æ–¥–≥—É–∑–Ω–∏–∫</p>
            <p class="description">–∫–∞–∂–¥—ã–µ 2-4 —á–∞—Å–∞</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('diaper', 240)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div class="item" id="sleep">
        <span class="icon">üåô</span>
        <div class="content">
            <p class="title">–°–æ–Ω</p>
            <p class="description">–≤ —Å—Ä–µ–¥–Ω–µ–º 14-17 —á–∞—Å–æ–≤ –≤ —Å—É—Ç–∫–∏</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('sleep', 1440)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div class="item" id="temperature">
        <span class="icon">üå°Ô∏è</span>
        <div class="content">
            <p class="title">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</p>
            <p class="description">–∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('temperature', 180)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div class="item" id="burping">
        <span class="icon">üòä</span>
        <div class="content">
            <p class="title">–û—Ç—Ä—ã–∂–∫–∞</p>
            <p class="description">–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ—Ä–º–ª–µ–Ω–∏—è</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('burping', 180)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div class="item" id="contact">
        <span class="icon">‚úã</span>
        <div class="content">
            <p class="title">–ö–æ–Ω—Ç–∞–∫—Ç</p>
            <p class="description">–∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ</p>
            <p class="last-time">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞</p>
        </div>
        <button onclick="markDone('contact', 1440)">–°–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase SDK —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–µ–π -->
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js"></script>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBUUrP-CevoeDOsUZorjC6XDzZ-vd3Uauw",
            authDomain: "ds-nurce-bdc37.firebaseapp.com",
            databaseURL: "https://ds-nurce-bdc37-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ds-nurce-bdc37",
            storageBucket: "ds-nurce-bdc37.firebasestorage.app",
            messagingSenderId: "725307523922",
            appId: "1:725307523922:web:9bb5c6ae685e479719b08b"
        };

        // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
        const errorMessage = document.getElementById('error-message');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
            database = firebase.database();
            console.log("Database connected:", database);
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            errorMessage.textContent = "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏.";
            if (error.code === 'app/duplicate-app') {
                console.log("Firebase app already initialized, using existing instance");
                database = firebase.database();
                console.log("Database connected:", database);
            }
        }

        function markDone(id, maxMinutes) {
            if (!database) {
                console.error("Database not initialized");
                errorMessage.textContent = "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.";
                return;
            }
            try {
                const now = Date.now();
                console.log(`Marking ${id} as done at ${now}`);
                database.ref('actions/' + id).set({ timestamp: now }, (error) => {
                    if (error) {
                        console.error(`Failed to save ${id} to Firebase:`, error);
                        errorMessage.textContent = `–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ${error.message}`;
                    } else {
                        console.log(`Successfully saved ${id} to Firebase`);
                        updateTime(id, maxMinutes, now);
                    }
                });
            } catch (error) {
                console.error(`Error in markDone for ${id}:`, error);
                errorMessage.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        function updateTime(id, maxMinutes, timestamp) {
            try {
                const item = document.getElementById(id);
                const lastTimeElem = item.querySelector('.last-time');
                if (timestamp) {
                    const diff = Date.now() - timestamp;
                    const minutesAgo = Math.floor(diff / 60000);
                    lastTimeElem.textContent = `–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: ${minutesAgo} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
                    if (minutesAgo > maxMinutes) {
                        item.classList.add('overdue');
                    } else {
                        item.classList.remove('overdue');
                    }
                } else {
                    lastTimeElem.textContent = '–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: –Ω–∏–∫–æ–≥–¥–∞';
                    item.classList.add('overdue');
                }
            } catch (error) {
                console.error(`Error in updateTime for ${id}:`, error);
                errorMessage.textContent = `–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const items = [
            { id: 'feeding', max: 180 },
            { id: 'diaper', max: 240 },
            { id: 'sleep', max: 1440 },
            { id: 'temperature', max: 180 },
            { id: 'burping', max: 180 },
            { id: 'contact', max: 1440 }
        ];

        if (database) {
            items.forEach(item => {
                try {
                    database.ref('actions/' + item.id).on('value', (snapshot) => {
                        const data = snapshot.val();
                        console.log(`Received data for ${item.id}:`, data);
                        updateTime(item.id, item.max, data ? data.timestamp : null);
                    }, (error) => {
                        console.error(`Failed to read ${item.id} from Firebase:`, error);
                        errorMessage.textContent = `–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: ${error.message}`;
                    });
                } catch (error) {
                    console.error(`Error setting up listener for ${item.id}:`, error);
                    errorMessage.textContent = `–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: ${error.message}`;
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (database) {
                items.forEach(item => {
                    try {
                        database.ref('actions/' + item.id).once('value', (snapshot) => {
                            const data = snapshot.val();
                            updateTime(item.id, item.max, data ? data.timestamp : null);
                        }, (error) => {
                            console.error(`Failed to fetch ${item.id} in interval:`, error);
                            errorMessage.textContent = `–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`;
                        });
                    } catch (error) {
                        console.error(`Error in interval for ${item.id}:`, error);
                        errorMessage.textContent = `–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞: ${error.message}`;
                    }
                });
            }
        }, 60000);
    </script>
</body>
</html>
